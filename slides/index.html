<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>ASP.NET Web API - Fully customizable web framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/night.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<link rel="stylesheet" href="css/slides.css">
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>ASP.NET Web API</h1>
					<h3>Fully customizable web framework</h3>
					<p>
						<small>Shiwei Zhou</small>
					</p>
				</section>
				<section>
					<h2>Agenda</h2>
					<ul>
						<li>Http message lifecycle</li>
						<li>
							Basic extension point
							<ul>
								<li>Message handlers</li>
								<li>Action filters</li>
							</ul>
						</li>
						<li>
							Advanced extension point
							<ul>
								<li>Dependency Injection</li>
								<li>Model Binding</li>
								<li>Result Conversion</li>
							</ul>
						</li>
					</ul>
				</section>
				<section>
				<a href="http://www.asp.net/media/4071077/aspnet-web-api-poster.pdf" target="_blank">
					<img src="images/message_lifecycle.png">
				</a>
				</section>
				<section>
					<section>
						<h2>Http Message Handlers</h2>
						<img src="images/webapi_handler.png">
					</section>
					<section>
						<h2>Predefined Message Handlers</h2>
						<ul>
							<li><span class="highlight">HttpServer</span>: gets the request from the host.</li>
							<li><span class="highlight">HttpRoutingDispatcher</span>: dispatches the request based on the route.</li>
							<li><span class="highlight">HttpControllerDispatcher</span>: sends the request to a Web API controller.</li>
						</ul>
					</section>
					<section>
						<h2>How to customize?</h2>
						<pre><code data-trim contenteditable class="c#">
Task&lt;HttpResponseMessage&gt; SendAsync(
    HttpRequestMessage request, 
    CancellationToken cancellationToken);							
						</code></pre>
						<ol>
							<li>Process the request message.</li>
							<li>Call base.SendAsync to send the request to the inner handler.</li>
							<li>The inner handler returns a response  message. (asynchronous)</li>
							<li>Process the response and return it to the caller.</li>
						</ol>
					</section>
					<section>
						<h2>When to use?</h2>
						<blockquote class="fragment"><span class="highlight">cross-cutting</span> concerns <br/>operate at the level of <span class="highlight">HTTP messages</span></blockquote>
						<ul class="fragment">
							<li>Read or modify request headers.</li>
							<li>Add a response header to responses.</li>
							<li>Validate requests before they reach the controller.</li>
						</ul>
					</section>
					<section>
						<h2>Examples</h2>
						<ul>
							<li>X-HTTP-Method-Override</li>
							<li>JSON Vulnerability Protection</li>
						</ul>
					</section>
					<section>
						<h2>Pre-Route Message Handlers</h2>
						<img src="images/webapi_handler_1.png">
					</section>
					<section data-transition="none">
						<h2>Pre-Route Message Handlers</h2>
						<img src="images/webapi_handler_2.png">
					</section>
					<section>
						<h2>Examples</h2>
						<ul>
							<li>Checking for an API Key</li>
						</ul>
					</section>
				</section>
				<section>

					<section>
						<h2>Filters</h2>
						<p>A great way to add extra functionality to Web API service.</p>
						<ul>
							<li>Action Filters</li>
							<li>Exception Filters</li>
							<li style="color: #555555;">Authorization Filters</li>
						</ul>
					</section>
					<section>
						<h2>Filters invocation process</h2>
						<img src="images/webapifilters01.png">
					</section>
					<section>
						<h2><span class="highlight">Action Filter</span> <br/>OR<br/> <span class="highlight">MessageHandler</span></h2>
						<blockquote class="fragment">The major difference between their two is their focus.  Message Handlers are applied to all HTTP requests. They perform the function of an HTTP intermediary.  Filters apply only to requests that are dispatched to the particular controller/action where the filter is applied.</blockquote>
						<blockquote class="fragment">You should use MessageHandlers when you want the behaviour to be applied to the vast majority of requests.  Filters should be used when they are only applicable to certain resources.</blockquote>
					</section>
					<section>
						<h2>Example</h2>
						<ul>
							<li>Handling request model validation</li>
						</ul>
					</section>
					<section>
						<h2>Exception Filters</h2>
						<p>An exception filter is executed when a controller method throws any unhandled exception that is not an HttpResponseException exception.</p>
						<pre><code data-trim contenteditable class="c#">public virtual void OnException(HttpActionExecutedContext actionExecutedContext);</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h2>Routing</h2>
						<ul>
							<li>Matching the URI to a route template.</li>
							<li>Selecting a controller.</li>
							<li>Selecting an action.</li>
						</ul>
					</section>
					<section>
						<h2>Route templates</h2>
						<p>URI with placeholder values</p>
						<blockquote>"api/{controller}/public/{category}/{id}"</blockquote>
					</section>
					<section>
						<h2>Controller selection</h2>
						<ol>
							<li>Look in the route dictionary for the key "controller".</li>
							<li>Take the value for this key and append the string "Controller" to get the type name.</li>
							<li>
								Look for a Web API controller with this type name - IHttpControllerTypeResolver
								<ul class="fragment">
									<li>implement IHttpController</li>
									<li>are not abstract</li>
									<li>have a name that ends in "Controller"</li>
								</ul>
							</li>
						</ol>
					</section>
					<section>
						<img src="images/select_controller.png">
					</section>
					<section>
						<img src="images/select_controller2.png">
					</section>					
					<section>
						<h2>Extension Points</h2>
						<table>
							<thead>
								<tr>
									<th>Interface</th>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr><td class="highlight">IHttpControllerSelector</td><td>Selects the controller.</td></tr>
								<tr><td class="highlight">IHttpControllerTypeResolver</td><td>Gets the list of controller types.</td></tr>
								<tr><td class="highlight">IAssembliesResolver</td><td>Get the list of project assemblies.</td></tr>
								<tr><td class="highlight">IHttpControllerActivator</td><td>Create new controller instances.</td></tr>
							</tbody>
						</table>
					</section>
					<section>
						<h2>Example</h2>
						<a href="http://www.strathweb.com/2013/08/customizing-controller-discovery-in-asp-net-web-api/" target="_blank">Customizing controller discovery in ASP.NET Web API</a>
					</section>
					<section>
						<h2>Code Analysis - Dependency injection</h2>
						<ul>
							<li><a href="http://www.asp.net/web-api/overview/advanced/dependency-injection" target="_blank">Dependency Injection in ASP.NET Web API 2</a></li>
							<li>How to use IoC to Inject dependency for web api controller?</li>
						</ul>
					</section>
					<section>
						<h2>Action Selection</h2>
						<blockquote>IHttpActionSelector.SelectAction (HttpControllerContext) -> HttpActionDescriptor</blockquote>
						<ol>
							<li class="fragment">Create a list of all actions on the controller that match the HTTP request method.</li>
							<li class="fragment">If the route dictionary has an "action" entry, remove actions whose name does not match this value.</li>
							<li class="fragment">Try to match action parameters to the URI.</li>
							<li class="fragment">Ignore actions with the [NonAction] attribute.</li>
						</ol>
					</section>
					<section>
						<h2>Extension Points</h2>
						<table>
							<thead>
								<tr>
									<th>Interface</th>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr><td class="highlight">IHttpActionSelector</td><td>Selects the action.</td></tr>
								<tr><td class="highlight">IHttpActionInvoker</td><td>Invokes the action.</td></tr>
							</tbody>
						</table>
					</section>
				</section>
				<section>
					<section>
						<h2>Available results</h2>
						<table>
							<thead>
								<tr>
									<th>Return type</th>
									<th>How to creates the response</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>void</td>
									<td class="fragment">Return empty 204 (No Content)</td>
								</tr>
								<tr>
									<td>HttpResponseMessage</td>
									<td class="fragment">Convert directly to an HTTP response message</td>
								</tr>
								<tr>
									<td>IHttpActionResult</td>
									<td class="fragment">Call ExecuteAsync to create an HttpResponseMessage, then convert to an HTTP response message.</td>
								</tr>
								<tr>
									<td>Other type</td>
									<td class="fragment">Write the serialized return value into the response body; return 200 (OK).</td>
								</tr>
							</tbody>
						</table>
					</section>
					<section>
						<h2>Why IHttpActionResult?</h2>
						<ul>
							<li>Simplifies unit testings of controller.</li>
							<li class="fragment">Moves common logic for creating HTTP responses into separate classes.</li>
							<li class="fragment">Make the intent of the controller action clearer by hiding the low-level details of constructing the response.</li>
						</ul>
					</section>
					<section>
						<h2>About "Other Types"</h2>
						<ul>
							<li>More staight-forward</li>
							<li class="fragment">But cannot directly return an error code</li>
						</ul>
					</section>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
